# -*- coding: utf-8 -*-
import json
import datetime

from pyutil.net.get_local_ip import get_local_ip


def send_alarm(**kwargs):
    """
    send alarm

    args: 

    subject (str): 必选参数, 邮件主题
    recipient_list (list): 收件人列表,如果设置，直接以默认频次发到收件人列表,也可以不设置它，去admin界面订阅subject
    message (str): 消息内容
    stack_trace (str): 调用栈
    key (str): 用于去重的key
    request_repr (str): repr(request)

    example: 
    msg = {}
    msg['subject'] = 'subject'
    msg['message'] = 'message'
    send_alarm(**msg)

    or
    send_alarm(subject='subject', message='message')

    """
    subject = kwargs.get('subject')
    if subject is None:
        raise Exception('param subject is required')
    if not kwargs.has_key('key'):
        kwargs['key'] = subject
    kwargs['time'] = str(datetime.datetime.now())
    kwargs['host'] = get_local_ip()
    _send_alarm(json.dumps(kwargs))


ALARM_SERVICE_TOPIC = "alarm_service_log"


def _send_alarm(msg):
    return

import unittest
import logging

from pyutil.alarm.alarm_handler import AlarmHandler
from mock import patch
from mock_nsq_http_writer import MockNsqHttpWriter


@patch('pyutil.alarm._nsq_writer', MockNsqHttpWriter())
class TestAlarmHandler(unittest.TestCase):
    def setUp(self):
        self.logger = logging.getLogger()
        self.logger.addHandler(AlarmHandler(level=logging.WARN))

    def testLoggingInfo(self):
        logging.info("it's error to receive me")
        self.assertTrue(True)

    def testLoggingError(self):
        logging.error('oh no some error occured')
        self.assertTrue(True)

    def testLoggingException(self):
        try:
            raise Exception('some exception')
        except Exception as e:
            logging.exception(e)
        try:
            raise Exception('another exception')
        except Exception as e:
            logging.error('with prefix pppp ex=%s' % e)
        self.assertTrue(True)

import unittest

from pyutil.alarm.send_alarm import send_alarm
from mock import patch
from mock_nsq_http_writer import MockNsqHttpWriter


@patch('pyutil.alarm._nsq_writer', MockNsqHttpWriter())
class TestSendAlarm(unittest.TestCase):
    def setUp(self):
        pass

    def testSendAlarm(self):
        msg = {}
        msg['subject'] = 'ss_op /api/aa'
        msg['message'] = 'some error occured'
        msg['key'] = 'my dedup key'
        send_alarm(**msg)
        self.assertTrue(True)

    def testSendAlarmParams(self):
        send_alarm(subject='/api/aa', message='a short message')
        self.assertTrue(True)

    def testSendAlarmWithRecipients(self):
        msg = {}
        msg['subject'] = 'ss_op /api/aa'
        msg['message'] = 'some error occured'
        msg['recipient_list'] = ['zhenghuabin']
        send_alarm(**msg)
        self.assertTrue(True)

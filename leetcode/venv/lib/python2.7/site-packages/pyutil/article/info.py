#!/usr/bin/env python
#coding:utf-8
import threading
from thrift.transport import TSocket, TTransport
from thrift.protocol import TBinaryProtocol
from pyutil.thrift.transport import SocketPool
from pyutil.program.icrawler_util import str_dict
from ss.article.info import Info 

class ThriftInfo(threading.local):

    def __init__(self, host, port, timeout=1.0, conn_timeout=0.2):
        transport = SocketPool.TSocketPool(host, port, timeout, conn_timeout)
        transport = TTransport.TBufferedTransport(transport)
        protocol = TBinaryProtocol.TBinaryProtocol(transport)
        self.client = Info.Client(protocol)
        self.client.transport = transport

    def group_info(self, req):
        try:
            self.client.transport.open()
            rsp = self.client.group_info(req)
            return rsp
        finally:
            self.client.transport.close()

    def group_list(self, req):
        try:
            self.client.transport.open()
            rsp = self.client.group_list(req)
            return rsp
        finally:
            self.client.transport.close()
    
    def category_group_list(self, req):
        try:
            self.client.transport.open()
            rsp = self.client.category_group_list(req)
            return rsp
        finally:
            self.client.transport.close()

    def get_city_list(self, req):
        try:
            self.client.transport.open()
            rsp = self.client.get_city_list(req)
            return rsp
        finally:
            self.client.transport.close()

    def get_category_list(self, req):
        try:
            self.client.transport.open()
            rsp = self.client.get_category_list(req)
            return rsp
        finally:
            self.client.transport.close()

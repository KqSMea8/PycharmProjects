# coding: utf-8
# 测试一下metrics

import time
import random
from pyutil.cache.cache_class import CacheClass


class TestCache(CacheClass):
    def __init__(self):
        from ss_data.mc import old_group_data_client
        self.cache = old_group_data_client
        self.timeout = 30

    def _mget(self, item_ids):
        for item_id in item_ids:
            if item_id % 10 == 1:
                time.sleep(0.001)
        return {item_id: item_id for item_id in item_ids}


if __name__ == '__main__':
    from pyutil.program.conf import Conf
    conf = Conf('/opt/tiger/ss_conf/ss/memcache.conf')
    from ss_data.mc import config_cache
    config_cache(conf)
    c = TestCache()
    i = 0
    while True:
        ids = [random.randint(0, 100000) for _ in xrange(10)]
        ret = c.mget(ids)
        if i % 100 == 0:
            print 'heartbeat', ret
        i += 1




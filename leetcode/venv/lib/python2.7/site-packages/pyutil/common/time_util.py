#!/usr/bin/env python
#coding=utf8
###################################
# added by suyong
#
##################################
import time, datetime

def time2stamp(timestr, format_type='%Y-%m-%d %H:%M:%S'):
    return time.mktime(time.strptime(timestr, format_type))

def stamp2time(stamp, format_type='%Y-%m-%d %H:%M:%S'):
    return time.strftime(format_type, time.localtime(stamp))

def datetime2time(date_time):
    if not date_time:
        return 0
    try:
        ts = time.mktime(date_time.timetuple())
        return ts
    except:
        return 0

def datetime2str(date_time):
    return date_time.strftime("%Y-%m-%d %H:%M:%S")

#valid hour:10~22
def valid_hours(cur_ts, data_ts):
    if cur_ts <= data_ts:
        return 0
    past_seconds = int(cur_ts-data_ts)
    valid_hours = (past_seconds/86400)*12
    past_hours = (past_seconds%86400)/3600
    pb_hour = time.localtime(data_ts).tm_hour
    index = 0
    tmp_hour = pb_hour
    while index <= past_hours:
        tmp_hour += 1
        if tmp_hour > 23:
            tmp_hour = 0
        if tmp_hour >= 9 and tmp_hour <= 22:
            valid_hours += 1
        index += 1
    return valid_hours

#星期转字符串  0    1    2     3    4    5    6   这个是一周第几天
wday_to_str = ['w', 'w', 'w', 'w', 'w', 'e', 'e']
#小时转字符串   0    1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16   17   18   19   20   21   22   23
# n-normal b-早餐 l-午餐 s-晚餐 e-晚上
hour_to_str = ['n', 'n', 'n', 'n', 'n', 'n', 'n', 'n', 'b', 'b', 'n', 'l', 'l', 'n', 'n', 'n', 'n', 's', 's', 'n', 'n', 'e', 'e', 'e']
# 获取时间段
def get_time_section(ts):
    try:
        time_ts = time.localtime(ts)
        act_wday = time_ts.tm_wday
        act_hour = time_ts.tm_hour
    except:
        act_wday = 1
        act_hour = 8
    return wday_to_str[act_wday]+hour_to_str[act_hour]


if __name__ == '__main__':
    stamp = time.time()
    nowtime = stamp2time(stamp)
    print stamp, '-->', nowtime

    stamp = time2stamp(nowtime)
    print nowtime, '-->', stamp
    print stamp, '-->', stamp2time(stamp)

    dateC = datetime.datetime(2010,6,6,8,14,59)
    print dateC, '-->', datetime2time(dateC)
    print dateC, '-->', datetime2str(dateC)

    print valid_hours(1401854676.76, 1401379200.0)
    print get_time_section(time.time()-200000)

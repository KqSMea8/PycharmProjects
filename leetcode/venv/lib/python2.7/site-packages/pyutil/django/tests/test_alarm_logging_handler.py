import unittest
import sys
import logging
from django import http
from pyutil.django.alarm_logging_handler import AlarmLoggingHandler

class TestAlarmLoggingHandler(unittest.TestCase):
    def setUp(self):
        self.logger = logging.getLogger()
        self.logger.addHandler(AlarmLoggingHandler())
    def testLogging(self):
        request = http.HttpRequest()
        request.path = '/a/b/c'
        request.method = "GET"
        try:
            raise Exception('uncaught exception')
        except Exception as e:
            self.logger.error('Internal Server Error: %s' % request.path, 
                    exc_info=sys.exc_info(), 
                    extra={ 
                        'status_code': 500, 
                        'request':request 
                        }
                    )
        self.assertTrue(True)
    def testMassiveLogging(self):
        count = 2000
        for i in range(count):
            self.testLogging()

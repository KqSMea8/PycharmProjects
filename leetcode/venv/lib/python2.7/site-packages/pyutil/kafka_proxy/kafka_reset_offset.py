#!/usr/bin/env python
#coding: utf-8

import argparse
from kafka_proxy import KafkaProxy
from pyutil.program.conf import Conf


def parse_cmd():
    parse = argparse.ArgumentParser(description='reset offsets of the specified consumer group.')
    parse.add_argument('-c', "--cluster", type=str, required=True, help="Kafka cluster")
    parse.add_argument('-t', "--topic", type=str, required=True, help="Kafka topic")
    parse.add_argument('-g', "--group", type=str, required=True, help="Kafka consumer group name")
    parse.add_argument('-o', "--offset", type=int, required=True, help="the offset corresponding to the whence per partition")
    parse.add_argument('-w', "--whence", type=int, required=True, help="whence, 0 means oldest, 1 means current and 2 means newest")
    return parse


def _main(cluster, topic, consumer_group, offset, whence):
    conf = Conf("/opt/tiger/ss_conf/ss/kafka.conf")
    writer_handler = KafkaProxy(cluster_name=cluster, topic=topic, conf=conf, consumer_group=consumer_group)
    writer_handler.set_consumer_offset(offset, whence, True)


if __name__ == "__main__":
    parser = parse_cmd()
    args = parser.parse_args()
    _main(args.cluster, args.topic, args.group, args.offset, args.whence)


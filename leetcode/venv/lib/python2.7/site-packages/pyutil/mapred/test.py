#!/usr/bin/env python
#coding=utf8

import sys
sys.path.insert (0, "/optc/home/zhuliang/repos/pyutil/")

from pyutil.mapred import MapReduceJob

if __name__ == "__main__":
    '''
    run the job:
    python test.py 3 "/zhuliang/test_mapred_job_out" "/zhuliang/test_mapred_job.data"
    '''
    class Tester(MapReduceJob):
        def __init__(self):
            super(Tester, self).__init__(log_path="logs/test.log")
        
        def this_file_name(self):
            return "test.py"

        def mapper(self, line):
            print line
        def combiner(self, key, values):
            for v in values:
                print "%s\t%s" % (key, v)
        def reducer(self,key ,values):
           num = dict()
           self.inc_counter ("key_num")
           for v in values:
               if v in num:
                   num[v] += 1
               else:
                   num[v] = 1
           for k, v in num.items():
               print "%s_%s\t%s" % (key, k, v)

    t = Tester()
    t.run(sys.argv)

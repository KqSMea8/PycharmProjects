import struct, sys

from smart_index_updater_client import ThriftIndexUpdaterClient
from index_updater.ttypes import UpdateMultiSvrReq, UpdateMultiSvrRsp, UpdateFeatureMultiSvrReq
from index_service.ttypes import GidScore, BatchUpdateReq, BatchUpdateFeatureReq
#from profile_recommend.profile_recall.utils.user_profile_cache import UserCPKeywordCache
#from pyutil.program.lru import ExpiringLRUCache
#from ss_data.profile.user_store import ThriftUserProfileStore
from pyutil.program.sys_conf import SysConf
from pyutil.program.db import DAL
from pyutil.program.conf import Conf
#from ss_data.profile.feature_util import FeatureUtil


sys_conf = SysConf('/opt/tiger/ss_conf/ss')

def update_mult_svr():
    req = UpdateFeatureMultiSvrReq()
    req.server_list = ["10.8.131.212:9987"]
    batchUpdateReq = BatchUpdateFeatureReq()
    inverted_list = {}
    inverted_list["16999"] = [GidScore(1, 0.1, 11), GidScore(2, 0.2, 12)]
    inverted_list["719261"] = [GidScore(3, 0.1, 13), GidScore(4, 0.2, 14)]
    batchUpdateReq.inverted_index = inverted_list
    batchUpdateReq.prefix = "woca"
    req.req = batchUpdateReq
    req.server_list = ["10.8.131.212:9987"] * 2
    
    client = ThriftIndexUpdaterClient("data.index_updater.online","test")
    print req
    print client.update_feature_multi_svr(req)

if __name__ == "__main__":
    update_mult_svr()

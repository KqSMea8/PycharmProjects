#!/usr/bin/env python

import httplib, urllib

SMS_HOST = "10.4.18.100"
SMS_PORT = 80
SMS_POST_URL = "/sendsms"

# return val (status, count)
# status: 0 ok, 1 error
# count: number of messages sent successful

def send_sms(app_id, key, mobile, msg_content):
    httpClient = None
    try:
        params = urllib.urlencode({'app_id':app_id, 'key':key, 'mobile':mobile, 'msg_content':msg_content})
        headers = {"Content-type": "application/x-www-form-urlencoded;charset=gbk",
                         "Accept": "text/plain"}
        httpClient = httplib.HTTPConnection(SMS_HOST, SMS_PORT, timeout=10)
        httpClient.request("POST", SMS_POST_URL, params, headers)
        response = httpClient.getresponse()
        #print response.status
        #print response.reason
        #print response.read()
        #print response.getheaders()
    except Exception, e:
        return (1, 0)
    finally:
        if httpClient:
            httpClient.close()
    
        return (0, 1)

if __name__ == '__main__':
    import sys
    #send_sms('system_cdn', '5WDkOLtwbUivM', sys.argv[1], sys.argv[2].decode('utf-8').encode('gbk'))
    #send_sms('web_alarm', 'xFZc5IdRY5JbM', sys.argv[1], sys.argv[2].decode('utf-8').encode('gbk'))
    #send_sms('rec_alarm', 'QheCZq1pPVThs', sys.argv[1], sys.argv[2].decode('utf-8').encode('gbk'))
